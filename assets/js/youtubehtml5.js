"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function YouTubeToHtml5(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};for(var o in this.hooks={},this.options={},this.defaultOptions)this.options[o]=o in t?t[o]:this.defaultOptions[o];this.options.autoload&&this.load()}YouTubeToHtml5.prototype.defaultOptions={selector:"video[data-yt2html5]",attribute:"data-yt2html5",formats:"*",autoload:!0,withAudio:!1},YouTubeToHtml5.prototype.globalHooks={},YouTubeToHtml5.prototype.getHooks=function(t,o){var e=[];if(t in this.globalHooks){var i=this.globalHooks[t];i=(i=i.filter((function(t){return t.name===o}))).sort((function(t,o){return t.priority-o.priority})),e=e.concat(i)}if(t in this.hooks){var n=this.hooks[t];n=(n=n.filter((function(t){return t.name===o}))).sort((function(t,o){return t.priority-o.priority})),e=e.concat(n)}return e},YouTubeToHtml5.prototype.addHook=function(t,o){t in this.globalHooks||(this.globalHooks[t]=[]),t in this.hooks||(this.hooks[t]=[]),"global"in o&&o.global?this.globalHooks[t].push(o):this.hooks[t].push(o)},YouTubeToHtml5.prototype.addAction=function(t,o){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:10,i=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];this.addHook("actions",{name:t,callback:o,priority:e,global:i})},YouTubeToHtml5.prototype.doAction=function(t){for(var o,e=this.getHooks("actions",t),i=arguments.length,n=Array(1<i?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var a=0;a<e.length;a++)(o=e[a]).callback.apply(o,n)},YouTubeToHtml5.prototype.addFilter=function(t,o){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:10,i=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];this.addHook("filters",{name:t,callback:o,priority:e,global:i})},YouTubeToHtml5.prototype.applyFilters=function(t,o){for(var e,i=this.getHooks("filters",t),n=arguments.length,r=Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];for(var u=0;u<i.length;u++)o=(e=i[u]).callback.apply(e,[o].concat(r));return o},YouTubeToHtml5.prototype.itagMap={18:"360p",22:"720p",37:"1080p",38:"3072p",82:"360p3d",83:"480p3d",84:"720p3d",85:"1080p3d",133:"240pna",134:"360pna",135:"480pna",136:"720pna",137:"1080pna",264:"1440pna",298:"720p60",299:"1080p60na",160:"144pna",139:"48kbps",140:"128kbps",141:"256kbps"},YouTubeToHtml5.prototype.urlToId=function(t){var o=t.match(/^(?:http(?:s)?:\/\/)?(?:www\.)?(?:m\.)?(?:youtu\.be\/|(?:(?:youtube-nocookie\.com\/|youtube\.com\/)(?:(?:watch)?\?(?:.*&)?v(?:i)?=|(?:embed|v|vi|user)\/)))([a-zA-Z0-9\-_]*)/);return Array.isArray(o)&&o[1]?o[1]:t},YouTubeToHtml5.prototype.fetch=function(t){return new Promise((function(o,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){4===this.readyState&&(200<=this.status&&400>this.status?o(this.responseText):e(this))},i.send(),i=null}))},YouTubeToHtml5.prototype.getAllowedFormats=function(){var t=[];return Array.isArray(this.options.formats)?t=this.options.formats:this.itagMap[this.options.formats]?t=[this.options.formats]:"*"===this.options.formats&&(t=Object.values(this.itagMap).sort()),t},YouTubeToHtml5.prototype.getElements=function(t){var o=null;return t&&(o=NodeList.prototype.isPrototypeOf(t)||HTMLCollection.prototype.isPrototypeOf(t)?t:"object"===_typeof(t)&&"nodeType"in t&&t.nodeType?[t]:document.querySelectorAll(this.options.selector)),o=Array.from(o||""),this.applyFilters("elements",o)},YouTubeToHtml5.prototype.youtubeDataApiEndpoint=function(t){var o="https://invidious.privacyredirect.com/api/v1/videos/".concat(t);return this.applyFilters("api.endpoint",o,t,null)},YouTubeToHtml5.prototype.parseUriString=function(t){return t.split("&").reduce((function(t,o){var e=o.split("=").map((function(t){return decodeURIComponent(t.replace("+"," "))}));return t[e[0]]=e[1],t}),{})},YouTubeToHtml5.prototype.canPlayType=function(t){var o=null;return((o=/^audio/i.test(t)?document.createElement("audio"):document.createElement("video"))&&"function"==typeof o.canPlayType?o.canPlayType(t):"unknown")||"no"},YouTubeToHtml5.prototype.parseYoutubeMeta=function(t){var o=this,e=[],i=[];if("string"==typeof t)try{t=JSON.parse(t)}catch(t){return null}var n=t||{};return(n=this.applyFilters("api.response",n,t)).hasOwnProperty("url_encoded_fmt_stream_map")&&(e=e.concat(n.url_encoded_fmt_stream_map.split(",").map((function(t){return o.parseUriString(t)})))),n.adaptiveFormats&&(e=e.concat(n.formatStreams)),n.hasOwnProperty("adaptive_fmts")&&(e=e.concat(n.adaptive_fmts.split(",").map((function(t){return o.parseUriString(t)})))),n.formatStreams&&(e=e.concat(n.formatStreams)),e.forEach((function(t){if(t&&"itag"in t&&o.itagMap[t.itag]){var e={_raw:t,itag:t.itag,url:null,label:null,type:"unknown",mime:"unknown",hasAudio:!1,browserSupport:"unknown"};if("url"in t&&t.url&&(e.url=t.url),"audioQuality"in t&&t.audioQuality&&(e.hasAudio=!0),e.label="qualityLabel"in t&&t.qualityLabel?t.qualityLabel:o.itagMap[t.itag],"mimeType"in t){var n=t.mimeType.match(/^(audio|video)(?:\/([^;]+);)?/i);n[1]&&(e.type=n[1]),n[2]&&(e.mime=n[2]),e.browserSupport=o.canPlayType("".concat(e.type,"/").concat(e.mime))}e.url&&i.push(e)}})),i=this.applyFilters("api.results",i,n)},YouTubeToHtml5.prototype.load=function(){var t=this,o=this.getElements(this.options.selector);o&&o.length&&o.forEach((function(o){t.loadSingle(o)}))},YouTubeToHtml5.prototype.loadSingle=function(t){var o=this,e=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)||this.options.attribute;if(t.getAttribute(e)){var i=this.urlToId(t.getAttribute(e)),n=this.youtubeDataApiEndpoint(i);this.doAction("api.before",t),this.fetch(n).then((function(t){if(t){var e=JSON.parse(t),i=[];e.formatStreams.forEach((t=>{o.itagMap[t.itag]&&i.push(t)})),i.sort(((t,o)=>o.itag-t.itag));var n=document.querySelector("#my-video_html5_api"),r=i[0].url;n.setAttribute("src",r)}})).finally((function(e){o.doAction("api.after",t,e)}))}},"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)&&(module.exports=YouTubeToHtml5);